<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>خدمتي - لوحة التحكم الإدارية</title>
    <link
      href="https://fonts.googleapis.com/css?family=Poppins:400,500,700,800&display=swap"
      rel="stylesheet"
    />
    <link
      href="./assets/plugins/bootstrap/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="./assets/plugins/font-awesome/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="./assets/plugins/perfectscroll/perfect-scrollbar.css"
      rel="stylesheet"
    />
    <link href="./assets/css/main.min.css" rel="stylesheet" />
    <link href="./assets/css/custom.css" rel="stylesheet" />
    <link href="./assets/css/app.css" rel="stylesheet" />
  </head>
  <body>
    <div class="loader">
      <div class="spinner-grow text-primary" role="status">
        <span class="sr-only">Loading...</span>
      </div>
    </div>

    <div class="page-container">
      <div class="page-header">
        <nav class="navbar navbar-expand-lg d-flex justify-content-between">
          <div class="" id="navbarNav">
            <ul class="navbar-nav" id="leftNav">
              <li class="nav-item">
                <a class="nav-link" id="sidebar-toggle" href="#"
                  ><i data-feather="arrow-left"></i
                ></a>
              </li>
            </ul>
          </div>
          <div class="logo">
            <a class="navbar-brand" href="./orders.html"></a>
          </div>
          <div class="" id="headerNav">
            <ul class="navbar-nav">
              <li class="nav-item dropdown">
                <a
                  class="nav-link search-dropdown"
                  href="#"
                  id="searchDropDown"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                  ><i data-feather="search"></i
                ></a>
                <div
                  class="dropdown-menu dropdown-menu-end dropdown-lg search-drop-menu"
                  aria-labelledby="searchDropDown"
                >
                  <form>
                    <input
                      class="form-control"
                      type="text"
                      placeholder="Type something.."
                      aria-label="Search"
                    />
                  </form>
                </div>
              </li>

              <li class="nav-item dropdown">
                <a
                  class="nav-link profile-dropdown"
                  href="#"
                  id="profileDropDown"
                  role="button"
                  data-bs-toggle="dropdown"
                  aria-expanded="false"
                  ><img
                    src="./assets/images/avatars/profile-image.png"
                    alt=""
                /></a>
                <div
                  class="dropdown-menu dropdown-menu-end profile-drop-menu"
                  aria-labelledby="profileDropDown"
                >
                  
                  <a class="dropdown-item" href="./index.html"
                    ><i data-feather="log-out"></i>تسجيل الخروج</a
                  >
                </div>
              </li>
            </ul>
          </div>
        </nav>
      </div>
      <div class="page-sidebar">
        <ul class="list-unstyled accordion-menu">
          <li>
            <a href="./orders.html"><i data-feather="package"></i>الطلبات</a>
          </li>
          <li>
            <a href="./workers.html"
              ><i data-feather="user-check"></i>قائمة التقنيين</a
            >
          </li>
          <li>
            <a href="./history.html"
              ><i data-feather="hard-drive"></i>الطلبات المنجزة</a
            >
          </li>
          <li>
            <a href="./new.html"
              ><i data-feather="folder-plus"></i>الطلبات الواردة</a
            >
          </li>
        </ul>
      </div>
      <div class="page-content">
        <div class="main-wrapper">
          <div class="d-flex flex-column w-100">
            <div class="container-wrapper">
              <div
                class="d-flex align-items-center justify-content-between p pb-6"
              >
                <h2 class="m-0">التقنيين</h2>
                <div class="d-flex align-items-center">
                  <button
                    class="btn btn-primary btn-sm border border-3"
                    data-toggle="modal"
                    data-target="#newClientModal"
                  >
                    <i data-feather="user-plus" class="align-middle md-18"></i>
                    <span class="align-middle">إضافة عامل</span>
                  </button>
                  <button
                    class="btn btn-primary btn-sm border border-3"
                    data-toggle="modal"
                    data-target="#DeleteWorkerModal"
                  >
                    <i data-feather="user-x" class="align-middle md-18"></i>
                    <span class="align-middle">حذف عامل</span>
                  </button>
                  <button
                    class="btn btn-primary btn-sm border border-3"
                    data-toggle="modal"
                    data-target="#newOrderModal"
                  >
                    <i
                      data-feather="shopping-cart"
                      class="align-middle md-18"
                    ></i>
                    <span class="align-middle">إضافة طلب</span>
                  </button>
                </div>
              </div>
            </div>
            <div class="table-responsive">
              <table class="table m-0 bg-white">
                <thead class="thead-light">
                  <tr>
                    <th class="text-uppercase" style="width: 40px">رقم</th>
                    <th class="text-uppercase" style="width: 200px">الاسم</th>
                    <th class="text-uppercase" style="width: 150px">الرقم </th>
                    <th class="text-uppercase" style="width: 200px">البريد الإلكتروني</th>
                    <th class="text-uppercase" style="width: 150px">الخدمة</th>
                    <th class="text-uppercase" style="width: 100px">الحالة </th>
                    <th class="text-right text-uppercase" style="width: 100px">
                      العمر
                    </th>
                  </tr>
                </thead>
                <tbody id="tbody1"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Javascripts -->
    <script src="./assets/plugins/jquery/jquery-3.4.1.min.js"></script>
    <script src="./assets/plugins/bootstrap/js/bootstrap.min.js"></script>
    <script src="./assets/vendor/bootstrap.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="./assets/plugins/perfectscroll/perfect-scrollbar.min.js"></script>
    <script src="./assets/js/main.min.js"></script>
    <script src="./assets/vendor/popper.js"></script>
    <script src="./assets/vendor/simplebar.js"></script>
    <script src="./assets/vendor/Chart.min.js"></script>
    <script src="./assets/vendor/moment.min.js"></script>
    <script src="./assets/vendor/dateformat.js"></script>
    <script src="./assets/vendor/bootstrap-datepicker.min.js"></script>
    <script>
      window.theme = "default";
    </script>
    <script src="./assets/js/color_variables.js"></script>
    <script src="./assets/js/app.js"></script>
    <script src="./assets/vendor/dom-factory.js"></script>
    <script src="./assets/vendor/material-design-kit.js"></script>

    <script>
      (function () {
        "use strict";

        domFactory.handler.autoInit();

        var sidebarToggle = Array.prototype.slice.call(
          document.querySelectorAll('[data-toggle="sidebar"]')
        );

        sidebarToggle.forEach(function (toggle) {
          toggle.addEventListener("click", function (e) {
            var selector =
              e.currentTarget.getAttribute("data-target") || "#default-drawer";
            var drawer = document.querySelector(selector);
            if (drawer) {
              drawer.mdkDrawer.toggle();
            }
          });
        });

        window.top.location.hostname !== window.location.hostname &&
          (window.top.location = window.location);
      })();
    </script>

    <div
      class="modal fade"
      id="newClientModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="newClientModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="newClientModalLabel">
              إضافة عامل
            </h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-row">
              <div class="form-group col-md-6">
                <label>الاسم</label>
                <input
                  required
                  type="text"
                  class="form-control"
                  id="name"
                  placeholder="الاسم"
                />
              </div>
              <div class="form-group col-md-6">
                <label>الرقم</label>
                <input
                  required
                  type="number"
                  class="form-control"
                  id="number"
                  placeholder="الرقم"
                />
              </div>
              <div class="form-group col-md-6">
                <label>البريد الإلكتروني</label>
                <input
                  required
                  type="email"
                  id="email"
                  class="form-control"
                  placeholder="البريد الإلكتروني"
                />
              </div>
              <div class="form-group col-md-6">
                <label>الخدمة</label>
                <input
                  required
                  type="text"
                  id="service"
                  class="form-control"
                  placeholder="الخدمة"
                />
              </div>
              <div class="form-group col-md-6">
                <label>العمر</label>
                <input
                  required
                  type="number"
                  id="age"
                  class="form-control"
                  placeholder="العمر"
                />
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary border"
              data-dismiss="modal"
            >
              <i data-feather="x" class="md-18 align-middle"></i>
              <span class="align-middle">إغلاق</span>
            </button>
            <button
              data-dismiss="modal"
              type="button"
              class="btn btn-primary border"
              id="addbtn"
            >
              <i data-feather="plus" class="md-18 align-middle"></i>
              <span class="align-middle">إضافة</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="newOrderModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="newClientModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="newClientModalLabel">
              إضافة طلب جديد
            </h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-row">
              <div class="form-group col-md-6">
                <label>اسم الزبون</label>
                <input
                  required
                  type="text"
                  class="form-control"
                  id="client-name"
                  placeholder="اسم الزبون"
                />
              </div>
              <div class="form-group col-md-6">
                <label>بريد الزبون</label>
                <input
                  required
                  type="email"
                  class="form-control"
                  id="client-email"
                  placeholder="بريد الزبون"
                />
              </div>
              <div class="form-group col-md-6">
                <label>رقم الزبون</label>
                <input
                  required
                  type="number"
                  class="form-control"
                  id="client-number"
                  placeholder="رقم الزبون"
                />
              </div>
              <br />
              <div class="form-group col-md-6">
                <label>بريد العامل</label>
                <input
                  required
                  type="email"
                  id="worker-email"
                  class="form-control"
                  placeholder="بريد العامل"
                />
              </div>
              <br />
              <div class="form-group col-md-6">
                <label>الخدمة</label>
                <input
                  required
                  type="text"
                  id="service1"
                  class="form-control"
                  placeholder="الخدمة"
                />
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary border"
              data-dismiss="modal"
            >
              <i data-feather="x" class="md-18 align-middle"></i>
              <span class="align-middle">إغلاق</span>
            </button>
            <button
              data-dismiss="modal"
              type="button"
              class="btn btn-primary border"
              id="addbtn1"
            >
              <i data-feather="plus" class="md-18 align-middle"></i>
              <span class="align-middle">إضافة</span>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div
      class="modal fade"
      id="DeleteWorkerModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="newClientModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="newClientModalLabel">حذف العامل</h5>
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="form-row">
              <div class="form-group col-md-6">
                <label>بريد العامل</label>
                <input
                  required
                  type="email"
                  id="worker-email1"
                  class="form-control"
                  placeholder="بريد العامل"
                />
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary border"
              data-dismiss="modal"
            >
              <i data-feather="x" class="md-18 align-middle"></i>
              <span class="align-middle">إغلاق</span>
            </button>
            <button
              data-dismiss="modal"
              type="button"
              class="btn btn-primary border"
              id="addbtn2"
            >
              <i data-feather="delete" class="md-18 align-middle"></i>
              <span class="align-middle">حذف</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="./assets/vendor/select2.full.min.js"></script>

    <script type="module">
      var tbody = document.getElementById("tbody1");
      var WorkerNum = 0;
      var WorkerList = [];
      function AddItemToTable(name, number, email, service, connected, age) {
        let trow = document.createElement("tr");
        let td0 = document.createElement("td");
        let td1 = document.createElement("td");
        let td2 = document.createElement("td");
        let td3 = document.createElement("td");
        let td4 = document.createElement("td");
        let td5 = document.createElement("td");
        let td6 = document.createElement("td");

        WorkerList.push([email]);
        td0.innerHTML = ++WorkerNum;
        td1.innerHTML = name;
        td2.innerHTML = number;
        td3.innerHTML = email;
        td4.innerHTML = service;
        td5.innerHTML = connected;
        td6.innerHTML = age;

        trow.appendChild(td0);
        trow.appendChild(td1);
        trow.appendChild(td2);
        trow.appendChild(td3);
        trow.appendChild(td4);
        trow.appendChild(td5);
        trow.appendChild(td6);

        tbody.appendChild(trow);
      }

      let ClientNameBox = document.getElementById("client-name");
      let ClientEmailBox = document.getElementById("client-email");
      let ClientNumberBox = document.getElementById("client-number");
      let WorkerEmailBox = document.getElementById("worker-email");
      let ServiceBox1 = document.getElementById("service1");

      let Addbtn1 = document.getElementById("addbtn1");

      function AddAllItemsToTable(user) {
        tbody.innerHTML = "";
        user.forEach((element) => {
          AddItemToTable(
            element.Name,
            element.Number,
            element.Email,
            element.Service,
            element.connected,
            element.age
          );
        });
      }

      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
      import {
        getFirestore,
        doc,
        getDocs,
        getDoc,
        addDoc,
        setDoc,
        deleteDoc,
        onSnapshot,
        collection,
      } from "https://www.gstatic.com/firebasejs/9.21.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDwOmXya7PMnByQvQSEd96zFOQ485W4LKQ",
        authDomain: "khedmatipro.firebaseapp.com",
        databaseURL:
          "https://khedmatipro-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "khedmatipro",
        storageBucket: "khedmatipro.appspot.com",
        messagingSenderId: "889692484643",
        appId: "1:889692484643:web:b7753e20956df89db2ed96",
        measurementId: "G-TZP0H9CGK6",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      let NameBox = document.getElementById("name");
      let NumberBox = document.getElementById("number");
      let EmailBox = document.getElementById("email");
      let ServiceBox = document.getElementById("service");
      let AgeBox = document.getElementById("age");

      let Addbtn = document.getElementById("addbtn");

      async function AddDocument_AutoID() {
        const docRef = doc(db, "workers", EmailBox.value);
        const data = {
          Name: NameBox.value,
          Number: NumberBox.value,
          Email: EmailBox.value,
          Service: ServiceBox.value,
          age: AgeBox.value,
          connected: "false",
        };

        setDoc(docRef, data)
          .then(() => {
            alert("Data added successfully.");
            window.location.reload();
          })
          .catch((error) => {
            alert("Unsuccessfull opertaion, Error " + error);
          });
      }
      Addbtn.addEventListener("click", AddDocument_AutoID);

      async function GetAllDataOnce() {
        const querySnapshot = await getDocs(collection(db, "workers"));

        var workers = [];
        querySnapshot.forEach((doc) => {
          workers.push(doc.data());
        });
        AddAllItemsToTable(workers);
      }

      async function AddDocument_AutoID1() {
        const p = doc(db, "workers", WorkerEmailBox.value);
        const docSnap = await getDoc(p);
        var data = docSnap.data();
        console.log(docSnap.data());

        var ref = collection(db, "orders");

        const docRef = await addDoc(ref, {
          Client_Name: ClientNameBox.value,
          Client_Email: ClientEmailBox.value,
          Client_Number: ClientNumberBox.value,
          Worker_Name: data.Name,
          Worker_Email: WorkerEmailBox.value,
          Worker_Number: data.Number,
          Service: ServiceBox1.value,
          Price: null,
        })
          .then(() => {
            alert("Data added successfully.");
            window.location.reload();
          })
          .catch((error) => {
            alert("Unsuccessfull opertaion, Error " + error);
          });
      }
      Addbtn1.addEventListener("click", AddDocument_AutoID1);

      let Worker_Email1 = document.getElementById("worker-email1");
      let Addbtn2 = document.getElementById("addbtn2");

      

      async function DeleteDocument() {
        await deleteDoc(doc(db, "workers", Worker_Email1.value))
          .then(() => {
            alert("Data Deleted successfully.");
            window.location.reload();
          })
          .catch((error) => {
            alert("Unsuccessfull opertaion, Error " + error);
          });
      }
      Addbtn2.addEventListener("click", DeleteDocument);

      window.onload = GetAllDataOnce;
    </script>
  </body>
</html>
